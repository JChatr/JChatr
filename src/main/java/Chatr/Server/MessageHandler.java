package Chatr.Server;

import Chatr.Converstation.Message;
import Chatr.Database.Database;

import java.util.ArrayList;
import java.util.List;

/**
 * server side message logic
 */
public class MessageHandler {
	private Database database;
	private List<Transmission> requests;
	private List<Transmission> responses = new ArrayList<>();

	/**
	 * Instantiates the MessageHandler
	 *
	 * @param requests request from the client
	 */
	protected MessageHandler(List<Transmission> requests) {
		this.database = Database.getCachedDatabase();
		this.requests = requests;
	}

	/**
	 * Directs requests to the corresponding methods
	 */
	public void routeRequests() {
		for (Transmission request : requests) {
			switch (request.getRequestType()) {
				case MESSAGE:
					switch (request.getCRUD()) {
						case CREATE: {
							boolean status = database.addMessage(request.getConversationID(), request.getMessage());
							responses.add(request.reset().setStatus(status));
							break;}
						case READ: {
							List<Message> m = database.readNewerMessages(request.getConversationID(),
									request.getMessage().getTime());
							responses.add(request.reset().setMessages(m));
							break;}
						case UPDATE: {
							boolean status = database.updateMessage(request.getConversationID(), request.getMessage());
							responses.add(request.reset().setStatus(status));
							break;}
						case DELETE:{
							boolean status = database.deleteMessage(request.getConversationID(),
									request.getMessage().getTime())
							responses.add(request.reset().setStatus(status));
							break;}
					}
					break;
				case CONVERSATION:
					switch (request.getCRUD()) {
						case CREATE:
						case READ:
						case UPDATE:
						case DELETE:
					}
					break;
				case USER:
					break;
				case STATUS:
					break;
			}
		}
	}

	/**
	 * Returns a list of all responses generated by the input requests
	 *
	 * @return list of responses generated by the requests
	 */
	public List<Transmission> getResponses() {
		return this.responses;
	}
}
